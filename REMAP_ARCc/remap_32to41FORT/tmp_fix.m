ffold = [-0.4166731  -0.2942262  -0.2127759   -0.1425033,...
 -8.2182385E-02 -3.0638598E-02  1.5896820E-02  5.8356058E-02  9.6364513E-02,...
  0.1276952      0.1384324       1.165008       1.165008       1.165008,...
   1.165008       1.165008       1.165008       1.165008       1.165008,...
   1.165008       1.165008       1.165008       1.165008       1.165008,...
   1.165008       1.165008       1.165008       1.165008       1.165008,...
   1.165008       1.165008       1.165008];

ffnew = [-0.3562309     -0.1888212     -0.1181910     -6.0799804E-02,...
 -1.8948363E-02  1.5115555E-02  5.3074114E-02  6.8065122E-02  9.5583245E-02,...
  0.1069876      0.1269140      0.1280736      0.1376511       1.165001,...
   1.165008       1.165008       1.165008       1.165008       1.165008,...
   1.165008       1.165008       1.165008       1.165008       1.165008,...
   1.165008       1.165008       1.165008       1.165008       1.165008,...
   1.165008       1.165008       1.165008       1.165008       1.165008,...
   1.165008       1.165008       1.165008       1.165008       1.165008,...
   1.165008       1.165008];

Znew=  [0.0000000E+00  -1.000000      -2.000000      -3.000000,...
  -4.000000      -5.000000      -6.000000      -7.000000      -8.000000,...
  -9.000000      -10.00000      -11.00000      -12.00000      -13.00000,...
  -13.00990      -13.00990      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990];

Zold =[0.0000000E+00 -0.5000000      -1.000000      -1.648000,...
  -2.584000      -3.570000      -4.732000      -6.106000      -7.724000,...
  -9.636000      -11.89200      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990      -13.00990      -13.00990,...
  -13.00990      -13.00990      -13.00990      -13.00990];

dZnew = abs(diff(Znew));
dZold = abs(diff(Zold));

Utot_old = sum(ffold.*dZold);
Utot_new = sum(ffnew.*dZnew);

h0=-13.0099;
du = Utot_old-Utot_new;
derr = du/abs(h0);
KDM=42;
%dmm=fnew;
for k=1:KDM
  dZZ=abs(Znew(k+1)-Znew(k));
  if dZZ<1e-4; break; end;
  adjU=derr*dZZ;
  fnew(k)=fnew(k)+adjU;
end



